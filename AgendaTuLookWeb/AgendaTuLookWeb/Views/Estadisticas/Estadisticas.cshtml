@model EstadisticasModel

<div class="row">
    <div class="col-12">
        <div class="card shadow-sm">
            <div class="card-header bg-light">
                <h3 class="mb-0">Estadísticas Generales</h3>
                <div class="filter-bar mt-3">
                    <form asp-controller="Estadisticas" asp-action="Estadisticas" method="get" class="d-flex flex-wrap align-items-end gap-3">
                        <div class="form-group">
                            <label for="fechaInicio">Fecha Inicio:</label>
                            <input type="date" id="fechaInicio" name="fechaInicio"
                                   value="@(ViewBag.FechaInicio ?? DateTime.Now.ToString("yyyy-MM-dd"))"
                                   class="form-control" />
                        </div>
                        <div class="form-group">
                            <label for="fechaFinal">Fecha Final:</label>
                            <input type="date" id="fechaFinal" name="fechaFinal"
                                   value="@(ViewBag.FechaFinal ?? new DateTime(DateTime.Now.Year, DateTime.Now.Month, DateTime.DaysInMonth(DateTime.Now.Year, DateTime.Now.Month)).ToString("yyyy-MM-dd"))"
                                   class="form-control" />
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary">Filtrar</button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="card-body">
                <div class="row">
                    <!-- Usuarios atendidos -->
                    <div class="col-md-4">
                        <div class="card bg-light mb-3">
                            <div class="card-body text-center">
                                <h5 class="card-title text-muted">Clientes Atendidos Este Mes</h5>
                                <h2 class="display-4 fw-bold text-primary">@(Model.UsuariosAtendidos ?? 0)</h2>
                                @if (Model.PorcentajeUsuariosAtendidos != null)
                                {
                                    <p class="text-success"><i class="bi bi-arrow-up"></i>@Model.PorcentajeUsuariosAtendidos % vs mes anterior</p>
                                }
                                else
                                {
                                    <p class="text-warning"><i class="bi bi-arrow-up"></i>No hay datos</p>
                                }
                            </div>
                        </div>
                    </div>

                    <!-- Nuevos usuarios -->
                    <div class="col-md-4">
                        <div class="card bg-light mb-3">
                            <div class="card-body text-center">
                                <h5 class="card-title text-muted">Nuevos Usuarios</h5>
                                <h2 class="display-4 fw-bold text-success">@(Model.UsuariosNuevos ?? 0)</h2>
                                @if (Model.PorcentajeUsuarioNuevos != null)
                                {
                                    <p class="text-success"><i class="bi bi-arrow-up"></i>@(Model.PorcentajeUsuarioNuevos ?? 0) % vs mes anterior</p>
                                }
                                else
                                {
                                    <p class="text-warning"><i class="bi bi-arrow-up"></i>No hay datos</p>
                                }
                            </div>
                        </div>
                    </div>

                    <!-- Citas nuevas -->
                    <div class="col-md-4">
                        <div class="card bg-light mb-3">
                            <div class="card-body text-center">
                                <h5 class="card-title text-muted">Citas Agendadas</h5>
                                <h2 class="display-4 fw-bold text-warning">@(Model.CitasNuevas ?? 0)</h2>
                                @if (Model.PorcentajeCitas != null)
                                {
                                    <p class="text-success"><i class="bi bi-arrow-up"></i>@Model.PorcentajeCitas % vs mes anterior</p>
                                }
                                else
                                {
                                    <p class="text-warning"><i class="bi bi-arrow-up"></i>No hay datos</p>
                                }
                            </div>
                        </div>
                    </div>
                </div> <!-- /row estadísticas -->
            </div> <!-- /card-body estadísticas -->
        </div> <!-- /card estadísticas -->
    </div> <!-- /col estadísticas -->
    <!-- Sección de Reviews -->
    <div class="col-12">
        <div class="card shadow-sm">
            <div class="card-header bg-light">
                <h3 class="mb-0">Reviews</h3>
            </div>
            <div class="card-body">
                <div class="row">
                    <!-- Totales -->
                    <div class="col-md-4">
                        <div class="card bg-light mb-3">
                            <div class="card-body text-center">
                                <h5 class="card-title text-muted">Total Reviews</h5>
                                <h2 class="display-4 fw-bold text-primary">@(Model.ReviewsTotales ?? 0)</h2>
                                @if (Model.PorcentajeTotalReviews != null)
                                {
                                    <p class="text-success"><i class="bi bi-arrow-up"></i>@Model.PorcentajeTotalReviews % vs mes anterior</p>
                                }
                                else
                                {
                                    <p class="text-warning"><i class="bi bi-arrow-up"></i>No hay datos</p>
                                }
                            </div>
                        </div>
                    </div>

                    <!-- Positivas -->
                    <div class="col-md-4">
                        <div class="card bg-light mb-3">
                            <div class="card-body text-center">
                                <h5 class="card-title text-muted">Reviews Positivas</h5>
                                <h2 class="display-4 fw-bold text-success">@(Model.ReviewsPositivasTotales ?? 0)</h2>
                                @if (Model.PorcentajeTotalReviewsPositivas != null)
                                {
                                    <p class="text-success"><i class="bi bi-arrow-up"></i>@Model.PorcentajeTotalReviewsPositivas % vs mes anterior</p>
                                }
                                else
                                {
                                    <p class="text-danger"><i class="bi bi-arrow-up"></i>No hay datos</p>
                                }
                            </div>
                        </div>
                    </div>

                    <!-- Negativas -->
                    <div class="col-md-4">
                        <div class="card bg-light mb-3">
                            <div class="card-body text-center">
                                <h5 class="card-title text-muted">Reviews Negativas</h5>
                                <h2 class="display-4 fw-bold text-danger">@(Model.ReviewsNegativasTotales ?? 0)</h2>
                                @if (Model.PorcentajeTotalReviewsNegativas != null)
                                {
                                    <p class="text-danger"><i class="bi bi-arrow-up"></i>@Model.PorcentajeTotalReviewsNegativas % vs mes anterior</p>
                                }
                                else
                                {
                                    <p class="text-success"><i class="bi bi-arrow-up"></i>No hay datos</p>
                                }
                            </div>
                        </div>
                    </div>

                    <!-- Tabla de reviews -->
                    <div class="col-md-12">
                        <div class="card bg-light mb-3">
                            <div class="card-body">
                                <h5 class="card-title text-muted">Reviews</h5>
                                @if (Model.Reviews != null)
                                {
                                    <table id="reviewsTable" class="table table-striped table-bordered">
                                        <thead>
                                            <tr>
                                                <th>Nombre del Atendido</th>
                                                <th>Review</th>
                                                <th>Calificación</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var review in Model.Reviews)
                                            {
                                                <tr>
                                                    <td>@review.Nombre</td>
                                                    <td>@review.ComentarioReview</td>
                                                    <td>@review.CalificacionReview</td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                }
                                else
                                {
                                    <p>No hay reviews</p>
                                }
                            </div>
                        </div>
                    </div>

                    <!-- Gráfico de Reviews Positivas vs Negativas -->
                    <div class="col-md-12">
                        <div class="card bg-light mb-3">
                            <div class="card-body text-center">
                                <h5 class="card-title text-muted">Gráfico de Reviews Positivas vs Negativas</h5>
                                <canvas id="chartReviewsPosVsNeg"
                                        height="200"
                                        class="mx-auto d-block"
                                        style="max-width: 400px;"
                                        data-reviews-data='[@Model.ReviewsPositivasTotales,@Model.ReviewsNegativasTotales]'></canvas>

                            </div>
                        </div>
                    </div>


                </div> 
            </div> 
        </div> 
    </div>
    
    <div class="col-12">
        <div class="card shadow-sm">
            <div class="card-header bg-light">
                <h3 class="mb-0">Información Financiera</h3>
            </div>
            <div class="card-body">
                <div class="row">
                    <!-- Total de ingresos -->
                    <div class="col-md-12 mb-3">
                        <div class="card bg-light mb-3 d-flex align-items-center justify-content-center" style="height: 100%;">
                            <div class="card-body text-center">
                                <h5 class="card-title text-muted">Ingreso Total</h5>
                                <h2 class="display-4 fw-bold text-success">₡@Model.IngresosTotales.ToString("N2")</h2>
                            </div>
                        </div>
                    </div>
                    <!-- Gráfico de ingresos por servicio -->
                    <div class="col-md-12">
                        <div class="card bg-light mb-3">
                            <div class="card-body text-center">
                                <h5 class="card-title text-muted">Ingresos por Servicio</h5>
                                <canvas id="chartIngresosPorServicio"
                                        height="200" class="mx-auto d-block" style="max-width: 500px;"
                                        data-servicios='@Html.Raw(Json.Serialize(Model.Servicios.Select(s => s.NombreServicio)))'
                                        data-ingresos='@Html.Raw(Json.Serialize(Model.Servicios.Select(s => s.Ingresos)))'></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
<script src="~/js/estadisticas/graficos.js"></script>

    
